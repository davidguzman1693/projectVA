<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <style>

  .axis text {
    font: 10px sans-serif;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .bar {
    fill: steelblue;
    fill-opacity: .9;
  }

  .x.axis path {
    display: none;
  }

  label {
    position: absolute;
    top: 10px;
    right: 10px;
  }

  body {
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    position: relative;
    width: 960px;
  }

  .axis text {
    font: 10px sans-serif;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .bar {
    fill: steelblue;
    fill-opacity: .9;
  }

  .x.axis path {
    display: none;
  }

  label {
    position: absolute;
    top: 10px;
    right: 10px;
  }

  svg {
      font: 12px sans-serif;
  }

  text {
      pointer-events: none;
  }

  .inner_node rect {
      pointer-events: all;
  }

  .inner_node rect.highlight {
      stroke: #315B7E;
      stroke-width: 2px;
  }

  .outer_node circle {
      fill: #fff;
      stroke: steelblue;
      stroke-width: 1.5px;
      pointer-events: all;
  }

  .outer_node circle.highlight
  {
      stroke: #315B7E;
      stroke-width: 2px;
  }

  .link {
      fill: none;
  }

  </style>
  <!--<script src="analytics.js"></script>-->
  <!--<script src="https://d3js.org/d3.v4.min.js"></script>-->
  <!--<script src="d3.js"></script>-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.10.0/d3.min.js"></script>
  <script>
    d3version4 = d3
    window.d3 = null
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
  <script>
    d3version3 = d3
    window.d3 = null
  </script>
  <script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
</head>
<body>
  <button onclick="showOnline()">Online clustering</button>
  <button onclick="showOffline()">Offline clustering</button>
  <div id="chart1"></div>
  <div id="chart"></div>
  <div id="chart2"></div>
  <div id="chartOnline"></div>
  
<script>

function showOnline() {
  document.getElementById("chartOnline").style.display = "None"; 
  document.getElementById("chart2").style.display = "None"; 

  document.getElementById("chart").style.display = "Block"; 
  document.getElementById("chart1").style.display = "Block"; 

  d3version4.select("svg").remove();
  d3version3.select("svg").remove();
  var refVector=[];
  var datVector=[];

  /*Variables for scatter plot*/
  var margin = {top: 20, right: 20, bottom: 30, left: 40},
      width = 960 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;

  /*var x = d3.scaleOrdinal()
      .rangeRoundBands([0, width], .1, 1);*/

  var x = d3version4.scaleBand()
      .rangeRound([0, width])
      .padding([0.5]);

  var y = d3version4.scaleLinear()
      .range([height, 0]);

  var xAxis = d3version4.axisBottom()
      .scale(x);

  var yAxis =  d3version4.axisLeft()
      .scale(y);
      //.tickFormat(formatPercent);

  var svgBar = d3version4.select("#chart1").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var dict = []; // create an empty array

  //Concept map
  var outer = d3version3.map();
  var inner = [];
  var links = [];

  var outerId = [0];

  concMap1 = []

  d3version3.csv("clustered.csv", function(error, dataframe) {

    dataframe.forEach(function(d) {
      if(!(d.clusterd in dict)){
        dict[d.clusterd] = 0;
      }else{
        dict[d.clusterd] = dict[d.clusterd] + 1;
      }

      //Concept map
      if(!(d.clusterd in concMap1)){
        concMap1[d.clusterd] = d.important.split(" ");
      }else{
        var s = concMap1[d.clusterd];
        var t = d.important.split(" ");
        s.push.apply(s, t)
        concMap1[d.clusterd] = s;
      }
    });

    x.domain(dataframe.map(function(d) { return d.clusterd; }));
    //y.domain([0, d3.max(data, function(d) { return d.frequency; })]);
    y.domain([0, d3version4.max(dataframe, function(d) { return dict[d.clusterd]; })]);

    svgBar.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

    svgBar.append("g")
        .attr("class", "y axis")
        .call(yAxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("Number of tweets");

    svgBar.selectAll(".bar")
        .data(dataframe)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("x", function(d) { return x(d.clusterd); })
        .attr("width", x.bandwidth())
        .attr("y", function(d) { return y(dict[d.clusterd]); })
        //.attr("height", function(d) { return height - y(dict[d.clusterd]); })
        .attr("height", function(d) { return height - y(dict[d.clusterd]); })
        .attr("selected",false)
        .on("click", function(d,i){
            console.log(d.clusterd) // Cluster of tweet
            // Remove active class from all buttons
            if (d3version4.select(this).attr("selected") === "false")
              {
              d3version4.select(this)
              .attr("selected",true)
                .style("fill","yellow")
                refVector.push(i);
                datVector.push(d.frequency);
                console.log(datVector)
            }
            else
            {
                d3version4.select(this)
              .attr("selected",false)
                .style("fill","steelblue")
                var index=refVector.indexOf(i)
                console.log(index)
                refVector.splice(index,1);
                datVector.splice(index,1);
                console.log(datVector)
            }
        });

    //First concept map
    data = [];

    count = 0;
    concMap1.forEach(function(a){
      s = new Set(a)
      s.delete('');
      data.push(["Cluster "+count,Array.from(s)]);
      count = count + 1;
    });

    console.log(data)

    data.forEach(function(d){      
      if (d == null)
        return;
      
      i = { id: 'i' + inner.length, name: d[0], related_links: [] };
      i.related_nodes = [i.id];
      inner.push(i);
      
      if (!Array.isArray(d[1]))
        d[1] = [d[1]];
      
      d[1].forEach(function(d1){
        
        o = outer.get(d1);
        
        if (o == null)
        {
          o = { name: d1, id: 'o' + outerId[0], related_links: [] };
          o.related_nodes = [o.id];
          outerId[0] = outerId[0] + 1;  
          
          outer.set(d1, o);
        }
        
        // create the links
        l = { id: 'l-' + i.id + '-' + o.id, inner: i, outer: o }
        links.push(l);
        
        // and the relationships
        i.related_nodes.push(o.id);
        i.related_links.push(l.id);
        o.related_nodes.push(i.id);
        o.related_links.push(l.id);
      });
    });

    data = {
      inner: inner,
      outer: outer.values(),
      links: links
    }

    // sort the data -- TODO: have multiple sort options
    outer = data.outer;
    data.outer = Array(outer.length);


    var i1 = 0;
    var i2 = outer.length - 1;

    for (var i = 0; i < data.outer.length; ++i)
    {
      if (i % 2 == 1)
        data.outer[i2--] = outer[i];
      else
        data.outer[i1++] = outer[i];
    }

    console.log(data.outer.reduce(function(a,b) { return a + b.related_links.length; }, 0) / data.outer.length);


    // from d3 colorbrewer: 
    // This product includes color specifications and designs developed by Cynthia Brewer (http://colorbrewer.org/).
    var colors = ["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]
    var color = d3version3.scale.linear()
        .domain([10, 220])
        .range([colors.length-1, 0])
        .clamp(true);

    var diameter = 960;
    var rect_width = 40;
    var rect_height = 14;

    var link_width = "1px"; 

    var il = data.inner.length;
    var ol = data.outer.length;

    var inner_y = d3version3.scale.linear()
        .domain([0, il])
        .range([-(il * rect_height)/2, (il * rect_height)/2]);

    mid = (data.outer.length/2.0)
    var outer_x = d3version3.scale.linear()
        .domain([0, mid, mid, data.outer.length])
        .range([15, 170, 190 ,355]);

    var outer_y = d3version3.scale.linear()
        .domain([0, data.outer.length])
        .range([0, diameter / 2 - 120]);


    // setup positioning
    data.outer = data.outer.map(function(d, i) { 
        d.x = outer_x(i);
        d.y = diameter/3;
        return d;
    });

    data.inner = data.inner.map(function(d, i) { 
        d.x = -(rect_width / 2);
        d.y = inner_y(i);
        return d;
    });


    function get_color(name)
    {
        var c = Math.round(color(name));
        if (isNaN(c))
            return '#dddddd'; // fallback color
        
        return colors[c];
    }

    // Can't just use d3version3.svg.diagonal because one edge is in normal space, the
    // other edge is in radial space. Since we can't just ask d3version3 to do projection
    // of a single point, do it ourselves the same way d3version3 would do it.  


    function projectX(x)
    {
        return ((x - 90) / 180 * Math.PI) - (Math.PI/2);
    }

    var diagonal = d3version3.svg.diagonal()
        .source(function(d) { return {"x": d.outer.y * Math.cos(projectX(d.outer.x)), 
                                      "y": -d.outer.y * Math.sin(projectX(d.outer.x))}; })            
        .target(function(d) { return {"x": d.inner.y + rect_height/2,
                                      "y": d.outer.x > 180 ? d.inner.x : d.inner.x + rect_width}; })
        .projection(function(d) { return [d.y, d.x]; });


    var svg = d3version3.select("#chart").append("svg")
        .attr("width", diameter)
        .attr("height", diameter)
      .append("g")
        .attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");
        

    // links
    var link = svg.append('g').attr('class', 'links').selectAll(".link")
        .data(data.links)
      .enter().append('path')
        .attr('class', 'link')
        .attr('id', function(d) { return d.id })
        .attr("d", diagonal)
        .attr('stroke', function(d) { return get_color(d.inner.name); })
        .attr('stroke-width', link_width);

    // outer nodes

    var onode = svg.append('g').selectAll(".outer_node")
        .data(data.outer)
      .enter().append("g")
        .attr("class", "outer_node")
        .attr("transform", function(d) { return "rotate(" + (d.x - 90) + ")translate(" + d.y + ")"; })
        .on("mouseover", mouseover)
        .on("mouseout", mouseout);
      
    onode.append("circle")
        .attr('id', function(d) { return d.id })
        .attr("r", 4.5);
      
    onode.append("circle")
        .attr('r', 20)
        .attr('visibility', 'hidden');
      
    onode.append("text")
      .attr('id', function(d) { return d.id + '-txt'; })
        .attr("dy", ".31em")
        .attr("text-anchor", function(d) { return d.x < 180 ? "start" : "end"; })
        .attr("transform", function(d) { return d.x < 180 ? "translate(8)" : "rotate(180)translate(-8)"; })
        .text(function(d) { return d.name; });
      
    // inner nodes
      
    var inode = svg.append('g').selectAll(".inner_node")
        .data(data.inner)
      .enter().append("g")
        .attr("class", "inner_node")
        .attr("transform", function(d, i) { return "translate(" + d.x + "," + d.y + ")"})
        .on("mouseover", mouseover)
        .on("mouseout", mouseout);
      
    inode.append('rect')
        .attr('width', rect_width)
        .attr('height', rect_height)
        .attr('id', function(d) { return d.id; })
        .attr('fill', function(d) { return get_color(d.name); });
      
    inode.append("text")
      .attr('id', function(d) { return d.id + '-txt'; })
        .attr('text-anchor', 'middle')
        .attr("transform", "translate(" + rect_width/2 + ", " + rect_height * .75 + ")")
        .text(function(d) { return d.name; });

    // need to specify x/y/etc

    d3version3.select(self.frameElement).style("height", diameter - 150 + "px");

    function mouseover(d)
    {
      // bring to front
      d3version3.selectAll('.links .link').sort(function(a, b){ return d.related_links.indexOf(a.id); }); 
      
        for (var i = 0; i < d.related_nodes.length; i++)
        {
            d3version3.select('#' + d.related_nodes[i]).classed('highlight', true);
            d3version3.select('#' + d.related_nodes[i] + '-txt').attr("font-weight", 'bold');
        }
        
        for (var i = 0; i < d.related_links.length; i++)
            d3version3.select('#' + d.related_links[i]).attr('stroke-width', '5px');
    }

    function mouseout(d)
    {     
        for (var i = 0; i < d.related_nodes.length; i++)
        {
            d3version3.select('#' + d.related_nodes[i]).classed('highlight', false);
            d3version3.select('#' + d.related_nodes[i] + '-txt').attr("font-weight", 'normal');
        }
        
        for (var i = 0; i < d.related_links.length; i++)
            d3version3.select('#' + d.related_links[i]).attr('stroke-width', link_width);
    }  

    
  });
}

function showOffline(){
  document.getElementById("chartOnline").style.display = "Block"; 
  document.getElementById("chart2").style.display = "Block"; 

  document.getElementById("chart").style.display = "None"; 
  document.getElementById("chart1").style.display = "None"; 
  var refVector=[];
  var datVector=[];
  d3version4.select("svg").remove();
  d3version3.select("svg").remove();

  /*Variables for scatter plot*/
  var margin = {top: 20, right: 20, bottom: 30, left: 40},
      width = 960 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;

  /*var x = d3.scaleOrdinal()
      .rangeRoundBands([0, width], .1, 1);*/

  // For chart2

  var x2 = d3version4.scaleBand()
      .rangeRound([0, width])
      .padding([0.5]);

  var y2 = d3version4.scaleLinear()
      .range([height, 0]);

  var xAxis2 = d3version4.axisBottom()
      .scale(x2);

  var yAxis2 =  d3version4.axisLeft()
      .scale(y2);

  var svg2 = d3version4.select("#chart2").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var dict2 = []

  //Jaccard
  var outerJac = d3version3.map();
  var innerJac = [];
  var linksJac = [];

  var outerIdJac = [0];

  conceMap2 = []

  d3version3.csv("clustered.csv", function(error, dataframe) {

    dataframe.forEach(function(d) {
      if(!(d.Jackcluster in dict2)){
        dict2[d.Jackcluster] = 0;
      }else{
        dict2[d.Jackcluster] = dict2[d.Jackcluster] + 1;
      }

      if(!(d.Jackcluster in conceMap2)){
        conceMap2[d.Jackcluster] = d.important.split(" ");
      }else{
        var s = conceMap2[d.Jackcluster];
        var t = d.important.split(" ");
        s.push.apply(s, t)
        conceMap2[d.Jackcluster] = s;
      } 
    });

    //Second cluster
    x2.domain(dataframe.map(function(d) { return d.Jackcluster; }));
    //y.domain([0, d3.max(data, function(d) { return d.frequency; })]);
    y2.domain([0, d3version4.max(dataframe, function(d) { return dict2[d.Jackcluster]; })]);

    svg2.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis2);

    svg2.append("g")
        .attr("class", "y axis")
        .call(yAxis2)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("Number of tweets");

    svg2.selectAll(".bar")
        .data(dataframe)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("x", function(d) { return x2(d.Jackcluster); })
        .attr("width", x2.bandwidth())
        .attr("y", function(d) { return y2(dict2[d.Jackcluster]); })
        //.attr("height", function(d) { return height - y(dict[d.clusterd]); })
        .attr("height", function(d) { return height - y2(dict2[d.Jackcluster]); })
        .attr("selected",false)
        .on("click", function(d,i){
            console.log(d.Jackcluster) // Cluster of tweet
            // Remove active class from all buttons
            if (d3version4.select(this).attr("selected") === "false")
              {
              d3version4.select(this)
              .attr("selected",true)
                .style("fill","yellow")
                refVector.push(i);
                datVector.push(d.frequency);
                console.log(datVector)
            }
            else
            {
                d3version4.select(this)
              .attr("selected",false)
                .style("fill","steelblue")
                var index=refVector.indexOf(i)
                console.log(index)
                refVector.splice(index,1);
                datVector.splice(index,1);
                console.log(datVector)
            }
        });

    d3version4.select("input").on("change", change);

    

    function change() {
      clearTimeout(sortTimeout);

      // Copy-on-write since tweens are evaluated after a delay.
      var x0 = x.domain(data.sort(this.checked
          ? function(a, b) { return b.frequency - a.frequency; }
          : function(a, b) { return d3version4.ascending(a.letter, b.letter); })
          .map(function(d) { return d.letter; }))
          .copy();

      svg.selectAll(".bar")
          .sort(function(a, b) { return x0(a.letter) - x0(b.letter); });

      var transition = svg.transition().duration(750),
          delay = function(d, i) { return i * 50; };

      transition.selectAll(".bar")
          .delay(delay)
          .attr("x", function(d) { return x0(d.letter); });

      transition.select(".x.axis")
          .call(xAxis)
        .selectAll("g")
          .delay(delay);
    }

    dataJac = [];

      count = 0;
      conceMap2.forEach(function(a){
        s = new Set(a);
        dataJac.push(["Cluster "+count,Array.from(s)]);
        count = count + 1;
      });

      dataJac.forEach(function(d){      
        if (d == null)
          return;
        
        i = { id: 'i' + innerJac.length, name: d[0], related_links: [] };
        i.related_nodes = [i.id];
        innerJac.push(i);
        
        if (!Array.isArray(d[1]))
          d[1] = [d[1]];
        
        d[1].forEach(function(d1){
          
          o = outerJac.get(d1);
          
          if (o == null)
          {
            o = { name: d1, id: 'o' + outerIdJac[0], related_links: [] };
            o.related_nodes = [o.id];
            outerIdJac[0] = outerIdJac[0] + 1;  
            
            outerJac.set(d1, o);
          }
          
          // create the links
          l = { id: 'l-' + i.id + '-' + o.id, inner: i, outer: o }
          linksJac.push(l);
          
          // and the relationships
          i.related_nodes.push(o.id);
          i.related_links.push(l.id);
          o.related_nodes.push(i.id);
          o.related_links.push(l.id);
        });
      });

      dataIntJac = {
        inner: innerJac,
        outer: outerJac.values(),
        links: linksJac
      }

      // sort the data -- TODO: have multiple sort options
      outer = dataIntJac.outer;
      dataIntJac.outer = Array(outer.length);


      var i1 = 0;
      var i2 = outer.length - 1;

      for (var i = 0; i < dataIntJac.outer.length; ++i)
      {
        if (i % 2 == 1)
          dataIntJac.outer[i2--] = outer[i];
        else
          dataIntJac.outer[i1++] = outer[i];
      }

      console.log(dataIntJac.outer.reduce(function(a,b) { return a + b.related_links.length; }, 0) / dataIntJac.outer.length);


      // from d3 colorbrewer: 
      // This product includes color specifications and designs developed by Cynthia Brewer (http://colorbrewer.org/).
      var colors = ["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]
      var color = d3version3.scale.linear()
          .domain([10, 220])
          .range([colors.length-1, 0])
          .clamp(true);

      var diameter = 960;
      var rect_width = 40;
      var rect_height = 14;

      var link_width = "1px"; 

      var il = dataIntJac.inner.length;
      var ol = dataIntJac.outer.length;

      var inner_y = d3version3.scale.linear()
          .domain([0, il])
          .range([-(il * rect_height)/2, (il * rect_height)/2]);

      mid = (dataIntJac.outer.length/2.0)
      var outer_x = d3version3.scale.linear()
          .domain([0, mid, mid, dataIntJac.outer.length])
          .range([15, 170, 190 ,355]);

      var outer_y = d3version3.scale.linear()
          .domain([0, dataIntJac.outer.length])
          .range([0, diameter / 2 - 120]);


      // setup positioning
      dataIntJac.outer = dataIntJac.outer.map(function(d, i) { 
          d.x = outer_x(i);
          d.y = diameter/3;
          return d;
      });

      dataIntJac.inner = dataIntJac.inner.map(function(d, i) { 
          d.x = -(rect_width / 2);
          d.y = inner_y(i);
          return d;
      });


      function get_color(name)
      {
          var c = Math.round(color(name));
          if (isNaN(c))
              return '#dddddd'; // fallback color
          
          return colors[c];
      }

      // Can't just use d3.svg.diagonal because one edge is in normal space, the
      // other edge is in radial space. Since we can't just ask d3 to do projection
      // of a single point, do it ourselves the same way d3 would do it.  


      function projectX(x)
      {
          return ((x - 90) / 180 * Math.PI) - (Math.PI/2);
      }

      var diagonal = d3version3.svg.diagonal()
          .source(function(d) { return {"x": d.outer.y * Math.cos(projectX(d.outer.x)), 
                                        "y": -d.outer.y * Math.sin(projectX(d.outer.x))}; })            
          .target(function(d) { return {"x": d.inner.y + rect_height/2,
                                        "y": d.outer.x > 180 ? d.inner.x : d.inner.x + rect_width}; })
          .projection(function(d) { return [d.y, d.x]; });


      var svg = d3version3.select("#chartOnline").append("svg")
          .attr("width", diameter)
          .attr("height", diameter)
        .append("g")
          .attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");
          

      // links
      var link = svg.append('g').attr('class', 'links').selectAll(".link")
          .data(dataIntJac.links)
        .enter().append('path')
          .attr('class', 'link')
          .attr('id', function(d) { return d.id })
          .attr("d", diagonal)
          .attr('stroke', function(d) { return get_color(d.inner.name); })
          .attr('stroke-width', link_width);

      // outer nodes

      var onode = svg.append('g').selectAll(".outer_node")
          .data(dataIntJac.outer)
        .enter().append("g")
          .attr("class", "outer_node")
          .attr("transform", function(d) { return "rotate(" + (d.x - 90) + ")translate(" + d.y + ")"; })
          .on("mouseover", mouseover)
          .on("mouseout", mouseout);
        
      onode.append("circle")
          .attr('id', function(d) { return d.id })
          .attr("r", 4.5);
        
      onode.append("circle")
          .attr('r', 20)
          .attr('visibility', 'hidden');
        
      onode.append("text")
        .attr('id', function(d) { return d.id + '-txt'; })
          .attr("dy", ".31em")
          .attr("text-anchor", function(d) { return d.x < 180 ? "start" : "end"; })
          .attr("transform", function(d) { return d.x < 180 ? "translate(8)" : "rotate(180)translate(-8)"; })
          .text(function(d) { return d.name; });
        
      // inner nodes
        
      var inode = svg.append('g').selectAll(".inner_node")
          .data(dataIntJac.inner)
        .enter().append("g")
          .attr("class", "inner_node")
          .attr("transform", function(d, i) { return "translate(" + d.x + "," + d.y + ")"})
          .on("mouseover", mouseover)
          .on("mouseout", mouseout);
        
      inode.append('rect')
          .attr('width', rect_width)
          .attr('height', rect_height)
          .attr('id', function(d) { return d.id; })
          .attr('fill', function(d) { return get_color(d.name); });
        
      inode.append("text")
        .attr('id', function(d) { return d.id + '-txt'; })
          .attr('text-anchor', 'middle')
          .attr("transform", "translate(" + rect_width/2 + ", " + rect_height * .75 + ")")
          .text(function(d) { return d.name; });

      // need to specify x/y/etc

      d3version3.select(self.frameElement).style("height", diameter - 150 + "px");

      function mouseover(d)
      {
        // bring to front
        d3version3.selectAll('.links .link').sort(function(a, b){ return d.related_links.indexOf(a.id); }); 
        
          for (var i = 0; i < d.related_nodes.length; i++)
          {
              d3version3.select('#' + d.related_nodes[i]).classed('highlight', true);
              d3version3.select('#' + d.related_nodes[i] + '-txt').attr("font-weight", 'bold');
          }
          
          for (var i = 0; i < d.related_links.length; i++)
              d3version3.select('#' + d.related_links[i]).attr('stroke-width', '5px');
      }

      function mouseout(d)
      {     
          for (var i = 0; i < d.related_nodes.length; i++)
          {
              d3version3.select('#' + d.related_nodes[i]).classed('highlight', false);
              d3version3.select('#' + d.related_nodes[i] + '-txt').attr("font-weight", 'normal');
          }
          
          for (var i = 0; i < d.related_links.length; i++)
              d3version3.select('#' + d.related_links[i]).attr('stroke-width', link_width);
      }    
  });
}

function setupButtons() {
  d3version3.selectAll('.button')
    .on('click', function () {
      
      // Find the button just clicked
      var button = d3version3.select(this);

      // Get the id of the button
      var buttonId = button.attr('id');

      console.log(buttonId)
      // Toggle the bubble chart based on
      // the currently clicked button.        
    });
}
    
setupButtons()
</script>
</body>